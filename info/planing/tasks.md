# Tasks

## Bugs

### 1. handle_browser_closing_error

**Описание:**  
При ручном закрытии страницы браузера агент падает с ошибкой при вызове любого инструмента и не может корректно обработать эту ошибку.

**Решение:**
1. Добавить специальную ошибку при закрытии браузера
2. Добавить инструмент открытия браузера

---

### 2. escape_error_loop

**Описание:**  
При попадании в цикл ошибок агент не может из него выбраться и начинает бесконечно вызывать инструменты без какого-то толка.

**Решение:**  
Необходимо разработать условия обращения к пользователю при определенном количестве повторений одной и той же ошибки подряд.

---

### 3. model_reasoning_logs

**Описание:**  
Нет адекватных рассуждений модели. В логах только скупой вывод "Модель думает" и вызовы функций.

---

### 4. function_call_format_error ⚠️

**Описание:**  
Ошибка формата функций, вызываемых агентом.

**Ошибка:**
```
❌ Ошибка при выполнении: Error code: 400 - {'error': {'message': "Failed to call a function. Please adjust your prompt. See 'failed_generation' for more details.", 'type': 'invalid_request_error', 'code': 'tool_use_failed', 'failed_generation': '<function=navigate{"url": "https://www.google.com/search?q=анчоус"}</function>\n'}}
```

**Предполагаемое решение:**  
Указание явного формата вызова функции. Groq API требует точную JSON Schema в формате OpenAI:

```json
{
  "type": "function",
  "function": {
    "name": "navigate",
    "description": "...",
    "parameters": {
      "type": "object",
      "properties": {
        "url": {
          "type": "string",
          "description": "Target URL"
        }
      },
      "required": ["url"]
    }
  }
}
```

---

## Refactoring

### 1. domain_error_classes

**Описание:**  
Разработать классы для внутренних ошибок системы и обеспечить их надежную обработку.

**Требования:**
1. Все ошибки должны наследоваться от единственного класса - `DomainError`
2. Класс должен включать обязательные поля:
   - `error_reason` - текстовое описание причины ошибки, понятное для агента
   - `proposed_fix` - простое описание решения ошибки (например, рекомендация вызова какого-нибудь инструмента)
3. Все ошибки должны находится в директории exceptions. 
4. Комментарии должны быть написаны на английском языке ТОЛЬКО в начале файла- кода ошибки и описывать ее суть и назначение. Никаких более коментариев оставлять не надо
5. Все ошибки должны находится в отдельных файлах. Исключения составляют только производные от одной и той же ошибки. Например уточненная версия ошибки. 
6. Необходимо создать следующие типы ошибок:
    1) BrowserIsClosed
    2) incorrect format of the function call by the agent
    3) ToolExecutionError - ошибка выполнения инструмента (таймауты, элемент не найден, ошибки Playwright)
    4) UnknownError
7. Необходимо внедрить в проект следующий формат обработки ошибок: 
```
try:
...
except BrowserError, Incorr....
    Обработка специфичных ошибок. ВНИМАНИЕ ТАКАЯ ОБРАБОТКУ ВСТАВЛЯТЬ ТОЛЬКО В МЕСТАХ 
    ГДЕ НЕОБХОДИМА РЕАКЦИЯ НА ТАКИЕ ОШИБКИ.
except DomainError:
    throw (Пробрасываем исключение дальше потому как оно оброаботано или реагируем на него в предыдущем блоке , если это необхходимо)
except Exceptions:
    throw UnknownError(... Оборачиваем неизвестные ошибки. Все ошибки во вссех местах системы должны быть обработаны)
```
Такие требования позволят сделайть систему предсказуемой, ограничить количество ее состояний и координировать агента.
**Решение**

---

# Resolved

## Fixed Bugs

*(Здесь будут отмечаться исправленные баги с их идентификаторами)*

## Conducted Refactorings

*(Здесь будут отмечаться проведенные рефакторинги с их идентификаторами)*